{
    "timestamp": "20250425_220528",
    "scan_id": "20250425_220528",
    "target": "http://example.com",
    "vulnerabilities": [
        {
            "type": "xss",
            "name": "Cross-Site Scripting (XSS)",
            "description": "XSS attacks allow attackers to execute scripts in a victim's browser, potentially stealing cookies, session tokens, or other sensitive information.",
            "severity": "High",
            "cwe": "CWE-79",
            "owasp_category": "A7:2017-XSS",
            "affected_endpoints": {
                "url": "http://example.com/search",
                "parameter": "q",
                "method": "GET",
                "evidence": "<script>alert(1)</script> was reflected in the response",
                "confidence": "High"
            },
            "remediation": {
                "description": "Implement proper input validation and output encoding",
                "steps": [
                    "Sanitize all user input before rendering it in HTML, JavaScript, CSS, or URLs",
                    "Use context-specific encoding (HTML entity encoding, JavaScript escaping, CSS escaping)",
                    "Implement Content-Security-Policy headers",
                    "Use modern frameworks with built-in XSS protection"
                ],
                "code_examples": {
                    "php": "echo htmlspecialchars($user_input, ENT_QUOTES, 'UTF-8');",
                    "javascript": "element.textContent = userInput; // instead of element.innerHTML",
                    "python": "from markupsafe import escape\nresponse = escape(user_input)"
                }
            }
        },
        {
            "type": "sql_injection",
            "name": "SQL Injection",
            "description": "SQL injection attacks allow attackers to manipulate database queries, potentially accessing, modifying, or deleting data.",
            "severity": "High",
            "cwe": "CWE-89",
            "owasp_category": "A1:2017-Injection",
            "affected_endpoints": {
                "url": "http://example.com/product",
                "parameter": "id",
                "method": "GET",
                "evidence": "Database error message exposed when using ' OR '1'='1",
                "confidence": "High"
            },
            "remediation": {
                "description": "Use parameterized queries/prepared statements and input validation",
                "steps": [
                    "Replace dynamic SQL with parameterized queries or prepared statements",
                    "Use an ORM (Object-Relational Mapping) framework",
                    "Apply input validation using whitelisting",
                    "Apply the principle of least privilege to database accounts"
                ],
                "code_examples": {
                    "php": "$stmt = $pdo->prepare('SELECT * FROM users WHERE email = ?');\n$stmt->execute([$email]);",
                    "java": "PreparedStatement stmt = conn.prepareStatement(\"SELECT * FROM users WHERE email = ?\");\nstmt.setString(1, email);",
                    "python": "cursor.execute('SELECT * FROM users WHERE email = %s', (email,))"
                }
            }
        },
        {
            "type": "csrf",
            "name": "Cross-Site Request Forgery (CSRF)",
            "description": "CSRF attacks trick users into performing unintended actions on websites they're authenticated to.",
            "severity": "Medium",
            "cwe": "CWE-352",
            "owasp_category": "A8:2013-CSRF",
            "affected_endpoints": {
                "url": "http://example.com/account/settings",
                "form_action": "update_email",
                "method": "POST",
                "evidence": "No CSRF token found in form",
                "confidence": "Medium"
            },
            "remediation": {
                "description": "Implement anti-CSRF tokens and same-site cookies",
                "steps": [
                    "Include anti-CSRF tokens in all state-changing forms",
                    "Set SameSite attribute on cookies (Strict or Lax)",
                    "Implement the 'double submit cookie' pattern",
                    "Verify the origin and referrer headers"
                ],
                "code_examples": {
                    "php": "// Generate token\n$_SESSION['csrf_token'] = bin2hex(random_bytes(32));\n// Verify token\nif (!hash_equals($_SESSION['csrf_token'], $_POST['csrf_token'])) {\n    die('CSRF attack detected');\n}",
                    "python": "# Using Django\n{% csrf_token %}",
                    "javascript": "// Add token to AJAX request\nconst token = document.querySelector('meta[name=\"csrf-token\"]').getAttribute('content');\nfetch(url, {\n    headers: {\n        'X-CSRF-Token': token\n    }\n});"
                }
            }
        },
        {
            "type": "open_redirect",
            "name": "Open Redirect",
            "description": "Open redirect vulnerabilities allow attackers to redirect users to malicious websites, often used in phishing attacks.",
            "severity": "Medium",
            "cwe": "CWE-601",
            "owasp_category": "A1:2017-Injection",
            "affected_endpoints": {
                "url": "http://example.com/redirect",
                "parameter": "url",
                "method": "GET",
                "evidence": "Redirected to external domain with no validation",
                "confidence": "High"
            },
            "remediation": {
                "description": "Implement proper validation of redirect URLs",
                "steps": [
                    "Use a whitelist of allowed redirect destinations",
                    "Don't allow user input to directly control redirect destinations",
                    "Implement indirect reference maps for redirects",
                    "If external redirects are necessary, present a warning page"
                ],
                "code_examples": {
                    "php": "// Validate against whitelist\n$allowed_domains = ['example.com', 'sub.example.com'];\n$parsed_url = parse_url($redirect_url);\nif (!in_array($parsed_url['host'], $allowed_domains)) {\n    $redirect_url = '/default-page';\n}",
                    "python": "# Use indirect references\nallow_redirects = {\n    'dashboard': '/dashboard',\n    'profile': '/user/profile'\n}\nredirect_to = allow_redirects.get(request.args.get('next'), '/default')"
                }
            }
        },
        {
            "type": "xxe",
            "name": "XML External Entity (XXE) Processing",
            "description": "XXE vulnerabilities allow attackers to access local files, perform SSRF attacks, or cause denial of service.",
            "severity": "High",
            "cwe": "CWE-611",
            "owasp_category": "A4:2017-XXE",
            "affected_endpoints": {
                "url": "http://example.com/api/import",
                "content_type": "application/xml",
                "method": "POST",
                "evidence": "Server processed external entity in XML request",
                "confidence": "Medium"
            },
            "remediation": {
                "description": "Disable external entity processing in XML parsers",
                "steps": [
                    "Disable DTDs (Document Type Definitions) completely if possible",
                    "Disable external entity processing in XML parsers",
                    "Use less complex data formats like JSON",
                    "Implement whitelisting of allowed XML entities"
                ],
                "code_examples": {
                    "java": "// Secure XML parsing\nDocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();\ndbf.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\ndbf.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\ndbf.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);",
                    "php": "// Secure XML parsing\n$loader = libxml_disable_entity_loader(true);\n$xml = simplexml_load_string($xmlString);\nlibxml_disable_entity_loader($loader);"
                }
            }
        },
        {
            "type": "ssrf",
            "name": "Server-Side Request Forgery (SSRF)",
            "description": "SSRF vulnerabilities allow attackers to make server-side requests to internal resources or external systems.",
            "severity": "High",
            "cwe": "CWE-918",
            "owasp_category": "A9:2017-SSRF",
            "affected_endpoints": {
                "url": "http://example.com/api/fetch-resource",
                "parameter": "url",
                "method": "POST",
                "evidence": "Server made request to internal resource",
                "confidence": "Medium"
            },
            "remediation": {
                "description": "Implement proper validation and restrictions for server-side requests",
                "steps": [
                    "Use a whitelist of allowed domains and URLs",
                    "Block requests to private IP addresses (127.0.0.1, 169.254.0.0/16, 172.16.0.0/12, etc.)",
                    "Disable redirects or validate the destination after following redirects",
                    "Use a separate service with restricted privileges for making external requests"
                ],
                "code_examples": {
                    "python": "def is_valid_url(url):\n    parsed = urlparse(url)\n    # Check if scheme is allowed\n    if parsed.scheme not in ['http', 'https']:\n        return False\n    # Check if hostname is in whitelist\n    if parsed.hostname not in ALLOWED_HOSTS:\n        return False\n    # Verify it's not an internal IP\n    try:\n        ip = socket.gethostbyname(parsed.hostname)\n        if ipaddress.ip_address(ip).is_private:\n            return False\n    except:\n        pass\n    return True"
                }
            }
        },
        {
            "type": "insecure_deserialization",
            "name": "Insecure Deserialization",
            "description": "Insecure deserialization vulnerabilities can allow attackers to execute arbitrary code by manipulating serialized objects.",
            "severity": "High",
            "cwe": "CWE-502",
            "owasp_category": "A8:2017-Insecure Deserialization",
            "affected_endpoints": {
                "url": "http://example.com/api/load-state",
                "parameter": "data",
                "method": "POST",
                "evidence": "Server deserializes user-provided data with PHP unserialize()",
                "confidence": "Medium"
            },
            "remediation": {
                "description": "Implement secure deserialization practices",
                "steps": [
                    "Use data format that doesn't allow code execution (JSON instead of native serialization)",
                    "Validate serialized data before deserializing",
                    "Run deserialization code with minimal privileges",
                    "Implement integrity checks (digital signatures) on serialized data"
                ],
                "code_examples": {
                    "java": "// Use JSON instead of native serialization\nObjectMapper mapper = new ObjectMapper();\nUser user = mapper.readValue(jsonString, User.class);",
                    "php": "// Use JSON instead of native serialization\n$data = json_decode($input, true);\n// Instead of\n// $data = unserialize($input);"
                }
            }
        }
    ],
    "summary": {
        "scan_date": "2025-04-25 22:05:28",
        "target": "http://example.com",
        "total_vulnerabilities": 7,
        "severity_counts": {
            "Critical": 0,
            "High": 5,
            "Medium": 2,
            "Low": 0,
            "Info": 0
        },
        "risk_score": 29,
        "risk_level": "Critical",
        "top_recommendations": [
            {
                "vulnerability": "Cross-Site Scripting (XSS)",
                "recommendation": "Implement proper input validation and output encoding"
            },
            {
                "vulnerability": "SQL Injection",
                "recommendation": "Use parameterized queries/prepared statements and input validation"
            },
            {
                "vulnerability": "XML External Entity (XXE) Processing",
                "recommendation": "Disable external entity processing in XML parsers"
            }
        ]
    }
}